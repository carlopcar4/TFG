const Dropdowns=(()=>{const t={escape:27,end:35,home:36,up:38,down:40};class e{constructor(t){this.trigger=t.trigger,this.dropdown=document.getElementById(t.dropdown),this.items=this.dropdown.querySelectorAll("[data-item]"),this.links=this.dropdown.querySelectorAll("[data-focus]"),[this.firstLink]=this.links,this.lastLink=this.links[this.links.length-1],this.state=[],this.currentFocusedIndex=0,this.hover=t.hover,this.isOpen=t.isOpen,this.autoClose=t.autoClose,this.open=this.open.bind(this),this.toggle=this.toggle.bind(this),this.onClick=this.onClick.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeydown=this.onKeydown.bind(this),this.isOpen&&this.open()}onClick(t){this.autoClose||t.target.closest(`#${this.trigger.id}, #${this.dropdown.id}`)||this.close(),this.autoClose&&!t.target.closest(`#${this.trigger.id}`)&&this.close()}onFocus(t){this.state.forEach((e,i)=>{t.target===e.link&&(this.currentFocusedIndex=i)})}setFocus(e){switch(e.preventDefault(),e.target===this.trigger&&(this.currentFocusedIndex=0),e.which){case t.up:this.state[this.currentFocusedIndex].prevLink.focus();break;case t.home:this.firstLink.focus();break;case t.end:this.lastLink.focus();break;case t.down:e.target!==this.trigger?this.state[this.currentFocusedIndex].nextLink.focus():this.firstLink.focus()}}onKeydown(e){switch(e.which){case t.escape:this.close(e);break;case t.up:case t.down:case t.home:case t.end:this.setFocus(e)}}addAttributes(){this.trigger.setAttribute("aria-haspopup",!0),this.trigger.setAttribute("aria-controls",this.trigger.dataset.target),this.dropdown.setAttribute("role","menu"),this.dropdown.setAttribute("aria-labelledby",this.trigger.id),this.dropdown.setAttribute("tabindex",-1),this.dropdown.setAttribute("aria-hidden",!this.isOpen),this.state.forEach(t=>{t.item&&t.item.setAttribute("role","none"),t.link.setAttribute("role","menuitem"),t.link.setAttribute("tabindex",-1)})}removeAttributes(){this.trigger.removeAttribute("aria-haspopup"),this.trigger.removeAttribute("aria-controls"),this.trigger.removeAttribute("aria-expanded"),this.dropdown.removeAttribute("role"),this.dropdown.removeAttribute("aria-labelledby"),this.dropdown.removeAttribute("tabindex"),this.dropdown.removeAttribute("aria-hidden"),this.state.forEach(t=>{t.item&&t.item.removeAttribute("role"),t.link.removeAttribute("role"),t.link.removeAttribute("tabindex")})}addEventListeners(){document.addEventListener("click",this.onClick),this.hover&&document.addEventListener("mouseover",this.onClick),this.trigger.addEventListener("keydown",this.onKeydown),this.dropdown.addEventListener("keydown",this.onKeydown),this.links.forEach(t=>{t.addEventListener("focus",this.onFocus)})}removeEventListeners(){document.removeEventListener("click",this.onClick),this.hover&&document.removeEventListener("mouseover",this.onClick),this.trigger.removeEventListener("keydown",this.onKeydown),this.dropdown.removeEventListener("keydown",this.onKeydown),this.links.forEach(t=>{t.removeEventListener("focus",this.onFocus)})}open(){this.isOpen=!0,this.trigger.setAttribute("aria-expanded",!0),this.dropdown.setAttribute("aria-hidden",!1),this.addEventListeners()}close(t){this.isOpen=!1,this.trigger.setAttribute("aria-expanded",!1),this.dropdown.setAttribute("aria-hidden",!0),this.removeEventListeners(),t&&this.trigger.focus()}toggle(t){t.preventDefault(),this.isOpen=!this.isOpen,this.isOpen?this.open():this.close()}destroy(){this.removeAttributes(),this.removeEventListeners(),this.trigger.removeEventListener("click",this.toggle),this.hover&&this.trigger.removeEventListener("mouseover",this.open)}render(){this.links.forEach((t,e)=>{this.state.push({item:this.items[e],link:t,prevLink:this.links[e-1]||this.lastLink,nextLink:this.links[e+1]||this.firstLink})}),this.addAttributes(),this.trigger.addEventListener("click",this.toggle),this.hover&&this.trigger.addEventListener("mouseover",this.open)}}const i=[];return{render:(t,{isOpen:s=!1,hover:r=!1,autoClose:o=!1}={})=>{const n=document.getElementById(t),h=n.dataset.target,d=new e({trigger:n,dropdown:h,isOpen:s,hover:r,autoClose:o});d.render(),i.push(d)},destroy:t=>{i.forEach((e,s)=>{t===e.trigger.id&&(e.destroy(),i.splice(s,1))})},init:()=>{const t={};document.querySelectorAll('[data-component="dropdown"]').forEach(i=>{t.trigger=i,t.dropdown=i.dataset.target,t.hover="true"===i.dataset.hover,t.isOpen="true"===i.dataset.open,t.autoClose="true"===i.dataset.autoClose,new e(t).render()})}}})();export default Dropdowns;